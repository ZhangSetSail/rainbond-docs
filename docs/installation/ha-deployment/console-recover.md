---
title: 控制台高可用
description: 该文档描述控制台高可用，适用于从体验环境迁移控制台到高可用集群环境。
keywords:
- Rainbond 控制台高可用安装
---

:::tip
如果你的 Rainbond 集群是通过 Helm Chart 安装的，那么控制台已经高可用，无需进行本文档的操作。
:::

## 前提

* Rainbond 控制台是通过 Allinone 部署的
* 已经安装好的高可用 Rainbond 集群
* 确保集群内资源大于 2GB

## 部署控制台到 Rainbond

首先依然访问 Rainbond 控制台，创建一个`系统服务`团队用来部署系统应用。进入团队空间选择新增，基于应用市场创建组件。在开源应用商店中搜索`rainbond` 找到`Rainbond-开源`应用。

![image-20210220194607418](https://static.goodrain.com/images/5.3/get-rainbond-app.png)

点击安装，选择对应的版本安装，完成 Rainbond 控制台的部署。等到控制台启动成功后即可通过默认域名访问新的控制台。在新控制台中完成管理员账号的注册从而进入到数据恢复页面。

:::tip
注意：若你需要使用云数据库或自建的高可用数据库，可通过第三方组件添加外部数据库后替换安装的应用中的 Mysql 数据库组件。第三方组件中的连接变量信息需要与 Mysql 组件保持一致。
Rainbond-UI 和 Rainbond-控制台 两个组件可以进行水平伸缩。
:::tip
### 备份老控制台的数据

回到老控制台的企业视图 -> 设置页面，切换到数据备份页面。如下图所示：

![image-20210221110158065](https://static.goodrain.com/images/5.3/data-backup.png)

点击`增加备份`,备份老控制台的最新数据。

![image-20210221110748507](https://static.goodrain.com/images/5.3/down-backup-date.png)

备份成功后如上图所示出现一条备份记录，点击下载将备份数据下载到本地备用。

### 导入数据到新控制台

1. 访问在 Rainbond 中部署的新控制台，同样进入到数据备份页面，点击导入备份，上传上一步下载的备份数据。

2. 上传成功后点击`恢复`，将数据导入到新的控制台中。恢复成功后需要`退出登录`，使用老控制台的账号信息登录。你将会发现数据已经迁移成功。

到此控制台迁移已经完成，你可以使用平台网关策略管理为控制台绑定你自己的域名，或 TCP 策略。[参考文档](/docs/use-manual/team-manage/gateway/rules/domain/)

:::tip
* 若恢复后平台自动退出登录，请重新访问新控制台域名，不要携带 path 路径，使用老控制台的账号进行登录。因为历史数据已经失效。
* 请定期备份平台数据，以方便在紧急情况下异地恢复控制台服务。
* 请在部署了控制台的应用内修改应用的英文名称以及组件的应用名称，以防控制台无法使用时可通过 Kubectl 命令行找到该POD。
:::

### 已知问题

迁移控制台后，恢复备份时从主机安装的 Kubernetes 集群信息不会被恢复，需手动拷贝集群安装信息。

1. 安装 [grctl](/docs/ops-guide/tools/grctl) 工具。
2. 进入`集群安装驱动服务` 组件内 > 伸缩复制`grctl`查询命令，并在服务器上执行找到 `/app/data` 对应的存储位置。
3. 将 `～/rainbonddata/cloudadaptor/enterprise` 下的数据拷贝至上一步 `集群安装驱动服务` 组件的存储路径中。
4. 进入企业视图  > 集群 > 节点配置，节点信息存在则成功。

